989 - 1006

# Описание
Схема на странице 990. 
Устройства имеют IPv4 адреса в подсетях 10.10.1.0/24 и 10.10.2.0/24. 

Сначала сделаем две VLAN и два физических интерфейса на **R1** для сообщения между ними. 

Далее три VLAN и trunking на **R1** - один физический интерфейс будет логически присутствовать в нескольких VLAN.

Конечная конфигурация: коммутаторы в VLAN 1, **PC2** и **PC4** в VLAN 2, **PC1** и **PC3** в VLAN 3, **R1** - шлюз по умолчанию для всех хостов, осуществляет маршрутизацию между VLAN. Связь **SW1**--**SW2** настроена как trunk, интерфейсу **R1__E0/0** присвоен IPv4 адрес.  
___

# Задача 1
992 - 998

## Шаг 1
Один из способов организовать сообщение между VLAN - физически соединить разные интерфейсы маршрутизатора с access-портами коммутаторов. Access-порты должны соответствовать нужным VLAN. 

Далее настроим соединение с портом, соответствующим VLAN 2. 

Обращаемся к **SW1**, с помощью **show interface status** изучаем информацию об интерфейсах коммутатора - VLAN, описание, режимы. Сгруппируем все связи **SW1**:

 - Связи с маршрутизатором: 
	 
	**R1__E0/0** <--> **SW1__E0/1** (VLAN 1)
	**R1__E0/1** <--> **SW1__E0/2** (VLAN 1)
	
	то есть, все интерфейсы маршрутизатора связаны с access-портами **SW1**, которым назначена VLAN 1. Выходов в VLAN 2 у маршрутизатора (на данный момент!) нет. 

- Связи со вторым коммутатором (**SW2**):
	
	**SW2__E0/0** <--> **SW1__E0/0**
	
	эта связь настроена в trunk.

- Связи с хостами:
	
	**PC1__E0/0** <--> **SW1__E1/0** (VLAN 1)
	**PC2__E0/0** <--> **SW1__E1/1** (VLAN 2)
	
	**PC2** в данный момент - единственная связь с VLAN 2. 

Наша ближайшая цель - открыть маршрутизатору доступ в VLAN 2. 

## Шаг 2
Для этого используем уже существующую связь **R1__E0/1** <--> **SW1__E0/2** и просто меняем VLAN (с первой на вторую) для этого порта на коммутаторе **SW1**. 

К концу шага **SW1__E0/2** относится к VLAN 2. Уже сейчас **R1** может выступать шлюзом по умолчанию для VLAN 1 и VLAN 2.

## Шаг 3
Назначаем правильный IP-адрес для интерфейса маршрутизатора, который мы вынесли в VLAN 2 на предыдущем шаге. 

## Шаг 4 
Далее мы хотим указать **R1** как шлюз по умолчанию для **PC4**. Предварительно убедимся, что **PC4** находится в VLAN 2. 

Известно, что **PC4** связан со вторым коммутатором так: **PC4__E0/0** <--> **SW2__E1/1**. Значит, нужно проверить этот интерфейс (этот порт) коммутатора **SW2**.

Вызываем информацию по VLAN на **SW2**, видим в списке нужный порт, он активен и имеет нужный номер VLAN - второй.

Альтернативный вариант: запросить у **PC4** информацию о соседях, используя Cisco Discovery Protocol. 

## Шаг 5
Теперь точно можно указать **R1** как шлюз по умолчанию для **PC4**.

## Шаг 6
Убеждаемся, что пинг от **PC4** до **PC1** успешен. Связь между VLAN работает!

Полезно представлять себе полный путь: 
**PC4** --> **SW2**  --trunk--> **SW1** --> **R1__E0/1** --> **R1__E0/0** --> **SW1** --> **PC1**

Интерфейсы явно указаны только для **R1**, чтобы подчеркнуть процесс маршрутизации - переброс пакета с одного пути на другой. Остальные интерфейсы очевидны и не так важны для иллюстрации. 

## Шаг 7
По аналогии с предыдущими шагами, хотим назначить **R1** шлюзом по умолчанию для **PC2**. Сначала проверяем, что на этом хосте верная VLAN. То есть, вторая. 

## Шаг 8
Проверили - назначаем. 

## Шаг 9
Пинг от **PC2** к **PC3** доказывает, что из VLAN2 можно попасть в VLAN 1. Итак, сообщение между VLAN работает в обе стороны. 
___

# Задача 2
998 - 1006

Вводится VLAN 3. Коммутаторы останутся в VLAN 1, хосты распределятся между двумя оставшимися. 

Если действовать как раньше, у маршрутизатора рано или поздно закончатся _физические_ порты. Вместо этого мы настроим **R1__E0/1** как trunk и организуем по _логическому_ соединению на каждую VLAN. 

В данной практике мы настроим таким образом только VLAN 2 и VLAN 3. В реальном мире _каждая_ VLAN должна быть отнесена к trunk-соединению маршрутизатора. 

## Шаг 1
Создадим VLAN 3 в консоли **SW1**, назовем ее Marketing. 

## Шаг 2
**SW1__E0/1** связан с **PC1**, назначим этому порту VLAN 3. 

## Шаг 3
Проверяем, что изменения вступили в силу, запросив актуальную информацию по VLAN.

## Шаг 4
В книге, вероятно, опечатка - первая строка дублирует следующий шаг. Со второй строки описание верное. 

В конспекте здесь и далее всё в нужном порядке - ориентир на команды консоли. 

На **PC1** задаем его собственный IP (эта подсеть будет иметь цифру 3 в предпоследнем октете - по аналогии с недавно созданной VLAN), а также указываем шлюз по умолчанию. Шлюзом будет адрес (виртуального) интерфейса на маршрутизаторе **R1**, который мы настроим позже. 

## Шаг 5
А здесь у книги неверна вторая строка шага, она про Шаг 4. 

Создаем VLAN 3 на втором коммутаторе, назначаем ее порту, который связан с **PC3** (это **SW2__E1/0**). 

## Шаг 6, 7
Проверяем, что мы верно настроили **SW2__E1/0**, запросив информацию по нему. Далее информация по VLAN 3. 

## Шаг 8
Настраиваем IP для **PC3** - ничего сложного, достаточно понять общий принцип присвоения адресов в этой практике (например, по начальной схеме). Этот хост также будет отнесен к VLAN 3 - соответственно, одна подсеть с **PC1**. 

## Шаг 9
**PC1** и **PС3** настроены - проверим связь, пусть даже она и внутри подсети. 

## Шаг 10, 11, 13
Имеется связь **R1__E0/1** <--> **SW1__E0/2**. Идея в том, что по этому каналу будет проходить траффик нескольких VLAN. Чтобы понять подробности, нужно хорошо знать про 802.1q encapsulation и Native VLAN. В этом вся суть схемы _router on a stick_. 

Итого настраиваем сначала **SW1** (нужно прописать разрешенные для этого канала VLAN - 2 и 3), затем **R1** (удаляем присвоенный IP). В конце необходимо создать логические суб-интерфейсы: **R1__E0/1.2** (для VLAN 2) и **R1__E0/1.3** (для VLAN 3) - и уже этим суб-интерфейсам будут назначены IP. Причем IP, очевидно, будут совпадать с адресами шлюзов по умолчанию, которые мы указывали ранее для хостов. 

## Шаг 14
Пинги от **R1** ко всем хостам. 

## Шаг 15
Пинги между хостами.

## Шаг 16
**Traceroute** между хостами - нужно убедиться, что маршрутизатор встречается на пути. 

## Шаг 17
Пинги от хоста к портам обоих коммутаторов, которые находятся в той же VLAN.  
